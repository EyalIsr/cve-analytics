import requests
import xml.etree.ElementTree as ET
import zipfile


def _download_cwe_xml(url, filename):
    response = requests.get(url)
    with open(filename, 'wb') as file:
        file.write(response.content)

def _parse_cwe_xml(filename):
    tree = ET.parse(filename)
    root = tree.getroot()
    wks = root.find('./{http://cwe.mitre.org/cwe-7}Weaknesses')
    cwe_list = []

    for weakness in wks:
        weakness_attributes = weakness.attrib
        cwe_id = weakness_attributes.get('ID')
        cwe_name = weakness_attributes.get('Name')
        cwe_list.append({'CWE ID': cwe_id, 'Name': cwe_name})

    return cwe_list

def get_cwe_list():
    XML_FILE_NAME = "cwec_v4.14.xml"
    # URL to the CWE XML file
    CWE_XML_URL = f'https://cwe.mitre.org/data/xml/{XML_FILE_NAME}.zip'
    # Local filename to save the XML file
    CWE_ZIP_FILENAME = f'{XML_FILE_NAME}.zip'

    _download_cwe_xml(CWE_XML_URL, CWE_ZIP_FILENAME)

    # Extract the XML file from the zip
    with zipfile.ZipFile(CWE_ZIP_FILENAME, 'r') as zip_ref:
        zip_ref.extractall()

    # Parse the CWE XML file
    cwe_list = _parse_cwe_xml(XML_FILE_NAME)
    return cwe_list if cwe_list else None
